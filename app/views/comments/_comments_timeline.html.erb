<h3 class="page-title">
  Comments Timeline
</h3>

<div class="comments-timeline-description">
  <i>Shows the number of comments on each week since the Project's start date</i>
</div>

<div class="gantt-timeline-container comments-timeline" data-controller="timeline" style="height: auto; max-height: none; overflow-x: auto; overflow-y: hidden;">
  <!-- Timeline header with dates -->
  <div class="gantt-timeline-header">
    <div class="gantt-info-column"></div>
    <div class="gantt-chart-area">
      <% 
        # Find the current week
        today = Date.today
        current_week_index = @weeks_data.index { |week| week[:week_start] <= today && today < week[:week_start] + 7.days }
      %>
      
      <% @weeks_data.each_with_index do |week, index| %>
        <div class="gantt-date-header <%= 'last-date' if index == @weeks_data.size - 1 %>">
          <%= week[:week_start].strftime("%m/%d/%y") %>
          <% if index < @weeks_data.size - 1 %>
            <div class="vertical-line"></div>
          <% end %>
          
          <% if index == current_week_index %>
            <div class="current-week-column"></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Timeline content -->
  <div class="gantt-timeline-content">
    <!-- Single project row -->
    <div class="gantt-project-row last-project">
      <!-- Project info (left side) -->
      <div class="gantt-info-column">
        <div class="project-name"><strong><%= @project.name %></strong></div>
        <div class="project-timeline-dates">
          <%= @project.start_date.strftime("%m/%d/%Y") %> -
          <%= @project.end_date.strftime("%m/%d/%Y") %>
        </div>
      </div>
      
      <!-- Chart area with week cells -->
      <div class="gantt-chart-area">
        <!-- Project bar container spanning the entire timeline -->
        <div class="project-bar-container" style="width: <%= @weeks_data.size * 80 %>px;">
          <div class="gantt-project-bar"></div>
        </div>
        
        <!-- Week cells with numbers -->
        <% @weeks_data.each_with_index do |week, week_index| %>
          <div class="week-cell" data-count="<%= week[:count] %>" style="left: <%= week_index * 80 %>px;">
            <%= link_to weekly_project_comments_path(@project, week_start: week[:week_start]), data: { turbo_frame: "weekly_comments_modal" } do %>
              <% if week[:count].positive? %>
                <strong><%= week[:count] %></strong>
              <% else %>
                0
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>